<div *ngIf="transferData?.length > 0">
    <br><br>
    <div class="divContainer singlepage-print" *ngIf="transferData?.length > 0">
        <h3 *ngIf="noTransits">There is no transit data available</h3>
        <h3 *ngIf="!noTransits">General Stats</h3>
        <div class="row">
            <div class="col-lg-4">
                <table class="table table-bordered transitTable">
                    <tr>
                        <th colspan="2"><h4>Transit stats</h4></th>
                    </tr>
                    <tr>
                        <td style="width: 50%">Departure port</td>
                        <td>{{getMatlabDateToJSTime(general.portDepartureTime)}}</td>
                    </tr>
                    <tr>
                        <td>Arrival wind farm</td>
                        <td>{{getMatlabDateToJSTime(general.WindFarmArrivalTime)}}</td>
                    </tr>
                    <tr>
                        <td>Departure wind farm</td>
                        <td>{{getMatlabDateToJSTime(general.departureWindFarmTime)}}</td>
                    </tr>
                    <tr>
                        <td>Arrival port</td>
                        <td>{{getMatlabDateToJSTime(general.portArrivalTime)}}</td>
                    </tr>
                    <tr>
                        <td>Visited wind farm(s)</td>
                        <td>{{visitedPark}}</td>
                    </tr>
                </table>
            </div>

            <div class="col-lg-4">
                <table class="table table-bordered transitTable">
                    <tr>
                        <th colspan="2"><h4>Consumed & landed stats</h4></th>
                    </tr>
                    <tr>
                        <td style="width: 50%">Fuel consumed</td>
                        <td *ngIf="this.tokenInfo.userPermission == 'Vessel master'"><input type="number" min="0" step="10" [(ngModel)]="generalInputStats.fuelConsumption" class="form-control-sm col-sm-10"> liters</td>
                        <td *ngIf="this.tokenInfo.userPermission != 'Vessel master'">{{roundNumber(enginedata.fuelUsedTotalM3, 10)}} m<sup>3</sup></td>
                    </tr>
                    <tr>
                        <td>Waste oil landed</td>
                        <td *ngIf="this.tokenInfo.userPermission == 'Vessel master'"><input type="number" min="0" step="10" [(ngModel)]="generalInputStats.landedOil" class="form-control-sm col-sm-10"> liters</td>
                        <td *ngIf="this.tokenInfo.userPermission != 'Vessel master'">{{generalInputStats.landedOil}} liters</td>
                    </tr>
                    <tr>
                        <td>Garbage landed</td>
                        <td *ngIf="this.tokenInfo.userPermission == 'Vessel master'"><input type="number" min="0" step="10" [(ngModel)]="generalInputStats.landedGarbage" class="form-control-sm col-sm-10"> m<sup>3</sup></td>
                        <td *ngIf="this.tokenInfo.userPermission != 'Vessel master'">{{generalInputStats.landedGarbage}} m<sup>3</sup></td>
                    </tr>
                    <tr>
                        <td>Fuel consumed transit to park</td>
                        <td>{{roundNumber(enginedata.fuelUsedDepartM3, 10)}} m<sup>3</sup></td>
                    </tr>
                    <tr>
                        <td>Fuel consumed transit from park</td>
                        <td>{{roundNumber(enginedata.fuelUsedReturnM3, 10)}} m<sup>3</sup></td>
                    </tr>
                    <tr>
                        <td>Fuel consumed dockings</td>
                        <td>{{roundNumber(enginedata.fuelUsedTransferM3, 10)}} m<sup>3</sup></td>
                    </tr>
                </table>
            </div>
            <div class="col-lg-4">
                <table class="table table-bordered transitTable">
                    <tr>
                        <th colspan="2"><h4>Engine stats</h4></th>
                    </tr>
                    <tr>
                        <td style="width: 50%">Fuel economy</td>
                        <td>{{roundNumber(general.FuelEcon, 10)}}</td>
                    </tr>
                    <tr>
                        <td>Efficiency of the trip</td>
                        <td>[insert interesting trip efficiency number]</td>
                    </tr>
                    <tr>
                        <td>Vessel fuel profiles</td>
                        <td>[insert interesting profile]</td>
                    </tr>  
                    <tr>
                        <td>Co2 emission</td>
                        <td>{{roundNumber(enginedata.co2TotalKg, 10, 'kg')}}</td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-4">
                <table class="table table-bordered transitTable">
                    <tr>
                        <th colspan="2"><h4>Transit stats</h4></th>
                    </tr>
                    <tr>
                        <td style="width: 50%">MSI outbound</td>
                        <td>{{roundNumber(general.MsiOutbound, 10, '%')}}</td>
                    </tr>
                    <tr>
                        <td>MSI inbound</td>
                        <td>{{roundNumber(general.MsiInbound, 10, '%')}}</td>
                    </tr>
                    <tr>
                        <td>WBV, technicians</td>
                        <td>{{roundNumber(general.WBVtechs, 100, ' (A8)')}}</td>
                    </tr>
                    <tr>
                        <td>WBV, vessel crew</td>
                        <td>{{roundNumber(general.WBVcrew, 100, ' (A8)')}}</td>
                    </tr>
                    <tr>
                        <td>Distance sailed</td>
                        <td>{{general.sailedDistance}}</td>
                    </tr>  
                </table>
            </div>
            <div class="col-lg-4">
                <table class="table table-bordered transitTable">
                    <tr>
                        <th colspan="2"><h4>Vessel perfomance</h4></th>
                    </tr>
                    <tr>
                        <td style="width: 50%">Avg. speed outbound</td>
                        <td>{{general.AvgSpeedOutbound}}</td>
                    </tr>
                    <tr>
                        <td>Avg. speed inbound</td>
                        <td>{{general.AvgSpeedInbound}}</td>
                    </tr>
                    <tr>
                        <td>Max. speed outbound</td>
                        <td>{{general.AvgSpeedOutboundUnrestricted}}</td>
                    </tr>
                    <tr>
                        <td>Max. speed inbound</td>
                        <td>{{general.AvgSpeedInboundUnrestricted}}</td>
                    </tr>
                    <tr>
                        <td>Average docking time</td>
                        <td>{{roundNumber(general.AverageDockedTime, 1)}}</td>
                    </tr>
                    <tr>
                        <td>Amount of unique PAX</td>
                        <td>16</td>
                    </tr>
                </table>
            </div>
            <div class="col-lg-4">
                <table class="table table-bordered transitTable">
                    <tr>
                        <th colspan="2"><h4>HSE</h4></th>
                    </tr>
                    <tr>
                        <td style="width: 50%"> HSE Observations</td>
                        <td *ngIf="this.tokenInfo.userPermission == 'Vessel master'"> 
                            <input type="radio" [(ngModel)]="generalInputStats.observations" [value]="true" name="observations"> Yes
                            <input type="radio" [(ngModel)]="generalInputStats.observations" [value]="false" name="observations"> No
                        </td>
                        <td *ngIf="this.tokenInfo.userPermission != 'Vessel master'">{{(generalInputStats.observations) ? 'Yes' : 'No'}}</td>
                    </tr>
                    
                    <tr>
                        <td>HSE Incidents</td>
                        <td *ngIf="this.tokenInfo.userPermission == 'Vessel master'" > 
                            <input type="radio" [(ngModel)]="generalInputStats.incidents" [value]="true" name="hseReports"> Yes
                            <input type="radio" [(ngModel)]="generalInputStats.incidents" [value]="false" name="hseReports"> No
                        </td>
                        <td *ngIf="this.tokenInfo.userPermission != 'Vessel master'">{{(generalInputStats.incidents) ? 'Yes' : 'No'}}</td>
                    </tr>
                    <tr>
                        <td>Tool box talks conducted</td>
                        <td *ngIf="this.tokenInfo.userPermission == 'Vessel master'">
                            <ng-multiselect-dropdown 
                                class="d-inline-block msdd" 
                                [placeholder]="'Select tool box talks'"
                                [data]="toolboxOptions"
                                [(ngModel)]="generalInputStats.toolboxConducted"
                                [settings]="multiSelectSettings">
                            </ng-multiselect-dropdown>
                        </td>
                        <td *ngIf="this.tokenInfo.userPermission != 'Vessel master'">{{(generalInputStats.toolboxConducted == '') ? 'None' : generalInputStats.toolboxConducted }}</td>
                    </tr>
                    
                    <tr>
                        <td>Drills conducted</td>
                        <td *ngIf="this.tokenInfo.userPermission == 'Vessel master'">
                            <ng-multiselect-dropdown 
                                class="d-inline-block msdd" 
                                [placeholder]="'Select drills'"
                                [data]="drillOptions"
                                [(ngModel)]="generalInputStats.drillsConducted"
                                [settings]="multiSelectSettings">
                            </ng-multiselect-dropdown>
                        </td>
                        <td *ngIf="this.tokenInfo.userPermission != 'Vessel master'"> {{(generalInputStats.drillsConducted == '') ? 'None' : generalInputStats.drillsConducted }} </td>
                    </tr>
                    <tr>
                        <td>Drills involved passengers</td>
                        <td *ngIf="this.tokenInfo.userPermission == 'Vessel master'" > 
                            <fieldset [disabled]="generalInputStats.drillsConducted.length == 0">
                                <input type="radio" [(ngModel)]="generalInputStats.passengers" [value]="true" name="passengers"> Yes
                                <input type="radio" [(ngModel)]="generalInputStats.passengers" [value]="false" name="passengers"> No
                            </fieldset>
                        </td>
                        <td *ngIf="this.tokenInfo.userPermission != 'Vessel master'">{{(generalInputStats.passengers) ? 'Yes' : 'No'}}</td>
                    </tr>
                    <tr>
                        <td style="width: 50%" rowspan>Comments field</td>
                        <td *ngIf="this.tokenInfo.userPermission == 'Vessel master'" rowspan='2'><textarea class="form-control" rows='4' [(ngModel)]="generalInputStats.customInput"></textarea></td>
                        <td *ngIf="this.tokenInfo.userPermission != 'Vessel master'" rowspan='2'><!-- {{generalInputStats.customInput}} !--> no comment has been inputted</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <br><br>

    <div *ngIf="parkFound && wavedata" class="row" class="weatherMap">
        <div class="col-xl-12 col-lg-24">
            <div class="card mb-3">
                <div class="card-header" >
                    Weather overview: {{wavedata? wavedata.site: ''}}
                    <ng-template #popContentWeatherOverview class="helpContent">
                        Weather overview for selected day and vessel. 
                        By default, only Hs and avg wind speed are shown.
                        Hidden or missing data is crossed through. To show or 
                        hide a particular dataset, click on the colored
                        bars in the legend. Hovering over the graph will 
                        display the recorded values at any time.
                    </ng-template>
                    <button type="button" class="btn btn-outline-secondary helpBtn" [autoClose]="true" 
                        [ngbPopover]="popContentWeatherOverview" placement="top" popoverClass="helpPopup">?</button>
                        
                    <button class="minimizer" (click)="minimizeWaveGraph()">
                        <i class="fa fa-window-minimize"></i>
                    </button>
                </div>
                <div class="weatherOverview" style="height: 400px" [hidden]="wavegraphMinimized">
                    <canvas id="weatherOverview"></canvas>
                </div>
            </div>
        </div>
        <br><br>
    </div>

    <div class="divContainer singlepage-print singlepage-print-port" *ngIf="transferData?.length > 0">
        <h3>Dockings</h3>
        <table class="table table-hover table-striped">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Start time</th>
                    <th>Stop time</th>
                    <th>Duration</th>
                    <th>Max impact</th>
                    <th>Score</th>
                    <th>Location</th>
                    <th>Pax in / out</th>
                    <th>Cargo in / out</th>
                    <th>Comment</th>
                    <th>Detector</th>
                    <th class="plsdonotprintthisforfsake">save</th>
                    <th class="plsdonotprintthisforfsake" *ngIf="videoRequestPermission">
                      Video request
                      <button type="button" class="btn btn-outline-secondary helpBtn longtermModule" [autoClose]="true"
                        [ngbPopover]="helpVideoRequests" placement="bottom" popoverClass="helpPopup" container="body">?
                      </button>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let transfer_Data of transferData;let ind = index" ng-form="myForm">
                    <td>{{ind + 1}}</td>
                    <td>{{getMatlabDateToJSTime(transfer_Data.startTime)}}</td>
                    <td>{{getMatlabDateToJSTime(transfer_Data.stopTime)}}</td>
                    <td>{{getMatlabDateToJSTimeDifference(transfer_Data.stopTime, transfer_Data.startTime)}}</td>
                    <td>{{roundNumber((transfer_Data.impactForceNmax / 1000), 1, 'KN')}} </td>
                    <td>{{roundNumber(transfer_Data.score, 10)}}</td>
                    <td>{{transfer_Data.location}}</td>
                    <td *ngIf="this.tokenInfo.userPermission == 'Vessel master'">
                        <input type="number" min="0" [value]="transfer_Data.paxUp" class="form-control-sm col-sm-5 form-number" [(ngModel)]="transfer_Data.paxUp" (change)="transfer_Data.formChanged=true"> incoming <br> 
                        <input type="number" min="0" [value]="transfer_Data.paxDown" class="form-control-sm col-sm-5 form-number"  [(ngModel)]="transfer_Data.paxDown" (change)="transfer_Data.formChanged=true"> outgoing
                    </td>
                    <td *ngIf="this.tokenInfo.userPermission == 'Vessel master'">
                        <input type="number" min="0" step="10" [value]="transfer_Data.cargoUp"  [(ngModel)]="transfer_Data.cargoUp" class="form-control-sm col-sm-3 col-xl-6 form-number" (change)="transfer_Data.formChanged=true"> KG incoming <br>
                        <input type="number" min="0" step="10" [value]="transfer_Data.cargoDown" [(ngModel)]="transfer_Data.cargoDown" class="form-control-sm col-sm-3 col-xl-6 form-number" (change)="transfer_Data.formChanged=true"> KG outgoing
                    </td>
                    <td *ngIf="this.tokenInfo.userPermission != 'Vessel master'">
                        {{transfer_Data.paxUp}} incoming <br> 
                        {{transfer_Data.paxDown}} outgoing
                    </td>
                    <td *ngIf="this.tokenInfo.userPermission != 'Vessel master'">
                        {{ transfer_Data.cargoUp }} KG incoming <br>
                        {{ transfer_Data.cargoDown}} KG outgoing
                    </td>
                    <td class="comment">
                        <span ngbDropdown class="d-inline-block dropdown">
                            <button class="btn btn-outline-primary" [class.commentOptions]="transfer_Data.comment != 'Other'" ngbDropdownToggle>
                                <span [class.commentButton]="transfer_Data.comment != 'Other'">{{transfer_Data.comment}}</span>
                            </button>
                            <span ngbDropdownMenu>
                                <button *ngFor="let opt of commentOptions" class="dropdown-item" (click)="transfer_Data.comment = opt;transfer_Data.formChanged=true">{{opt}}</button>
                            </span>
                        </span>
                        <span *ngIf="transfer_Data.comment == 'Other'">
                            <input name="otherComment" [(ngModel)]="transfer_Data.commentChanged.otherComment" type="text"
                                class="form-control otherComment" (ngModelChange)="transfer_Data.formChanged=true" />
                        </span>
                    </td>
                     <td>{{transfer_Data.detector}}</td>
                    <td class="plsdonotprintthisforfsake">
                        <button class="btn btn-lg btn-primary submitBtnDate" (click)="saveComment(transfer_Data)" type="button" [disabled]="!transfer_Data.formChanged">Save</button>
                    </td>
                    <td class="plsdonotprintthisforfsake" *ngIf="videoRequestPermission">
                        <button *ngIf="transfer_Data.video_requested" class="btn btn-lg btn-primary submitBtnDate videoRequest {{transfer_Data.video_requested.status}}" (click)="setRequest(transfer_Data);" type="button" [disabled]="transfer_Data.videoAvailable == 0 || transfer_Data.video_requested.disabled">{{transfer_Data.video_requested.text}}</button>
                    </td>
                </tr>
            </tbody>
        </table> 
        <ngb-alert *ngIf="showAlert" [type]="alert.type" (close)="showAlert=false">{{ alert.message }}</ngb-alert>
    </div>
    <div class="row singlepage-print singlepage-print-port"></div>
    <div class="row singlepage-print singlepage-print-port">
        <div class="col-lg-7 singlepage-print"  *ngFor="let transfer_Data of transferData;let ind = index">
            <span *ngIf="transfer_Data.slipGraph !== undefined && transfer_Data.slipGraph.slipX.length > 0">
                <h3>Transfer: #{{ind + 1}} - location: {{transfer_Data.location}} - Score:
                    {{roundNumber(transfer_Data.score, 10)}}</h3>
            </span>
            <div class="chartContainer">
                <canvas *ngIf="transfer_Data.slipGraph !== undefined && transfer_Data.slipGraph.slipX && transfer_Data.slipGraph.slipX.length !== undefined" id="canvas{{ind}}">{{charts[ind]}}</canvas>
            </div>
        </div>
    </div>
    <div class="videoRequestLoading" *ngIf="videoRequestLoading">
        <div class="spinner">
            <div class="bounce1"></div>
            <div class="bounce2"></div>
            <div class="bounce3"></div>
        </div>
    </div>
</div>

<ng-template #helpVideoRequests>
    Videos can be requested for recent transfers by anyone authorized to do so (If you see this button this is the case). 
    After a request is made, the video will be downloaded as soon as the vessel is back in the harbour. This usually takes
    up to 2 days. After the download is completed, a download link will be send to the account that made the request. Be
    aware that the link is only valid for 7 days!
    <br><br>
    If a video of interest is not available, this usually means the video has been deleted (we have limited storage space).
    This will not happen until at least a month has passed. We cannot recover deleted videos. To get access to a video which
    was already requested before, send an email to <a href = "mailto: info@bmo-offshore.com">info@bmo-offshore.com</a>
</ng-template>