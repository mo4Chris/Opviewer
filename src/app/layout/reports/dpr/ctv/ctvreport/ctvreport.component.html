<app-dpr-map *ngIf="hasData" style="width: 100%;" [vesselTrace]="vesselTrace" (onMapReady)="onMapReady($event)"
  [turbineVisits]="turbineTransfers">
</app-dpr-map>
<div *ngIf="!isLoading || hasData">
    <br><br>
    <div class="divContainer singlepage-print">
        <h3 *ngIf="!hasData">There is no data available</h3>
        <app-ctv-summary *ngIf="turbineTransfers.length>0" [general]="general" [generalInputStats]="generalInputStats"
            [engine]="enginedata" [tokenInfo]="tokenInfo" [visitedPark]="visitedPark"></app-ctv-summary>
    </div>
    <br><br>
    <div *ngIf="wavedataLoaded" class="row" class="weatherMap">
        <div class="col-xl-12 col-lg-24">
            <div class="card mb-3">
                <div class="card-header" >
                    Weather overview: {{wavedata? wavedata.site: ''}}
                    <ng-template #popContentWeatherOverview class="helpContent">
                        Weather overview for selected day and vessel. 
                        By default, only Hs and avg wind speed are shown.
                        Hidden or missing data is crossed through. To show or 
                        hide a particular dataset, click on the colored
                        bars in the legend. Hovering over the graph will 
                        display the recorded values at any time.
                    </ng-template>
                    <button type="button" class="btn btn-outline-secondary helpBtn" [autoClose]="true" 
                        [ngbPopover]="popContentWeatherOverview" placement="top" popoverClass="helpPopup">?</button>
                        
                    <button class="minimizer" (click)="minimizeWaveGraph()">
                        <i class="fa fa-window-minimize"></i>
                    </button>
                </div>
                <div class="weatherOverview" style="height: 400px" [hidden]="wavegraphMinimized">
                    <canvas id="weatherOverview"></canvas>
                </div>
            </div>
        </div>
        <br><br>
    </div>

    <div class="divContainer singlepage-print singlepage-print-port" *ngIf="transferData?.length > 0">
        <app-ctv-turbine-transfer [tokenInfo]="tokenInfo" [transfers]="transferData"
          (onVideoRequest)="onVideoRequest($event)"></app-ctv-turbine-transfer>
    </div>
    <div class="row singlepage-print singlepage-print-port">
        <div class="col-lg-7"  *ngFor="let visit of turbineVisits;let ind = index">
            <app-ctvslipgraph 
                [index]="ind" [transfer]="visit" [vesselUtcOffset]="vesselUtcOffset"></app-ctvslipgraph>
        </div>
    </div>
    <div class="videoRequestLoading" *ngIf="videoRequestLoading">
        Video requests loading!
        <div class="spinner">
            <div class="bounce1"></div>
            <div class="bounce2"></div>
            <div class="bounce3"></div>
        </div>
    </div>
</div>

<ng-template #helpVideoRequests>
    Videos can be requested for recent transfers by anyone authorized to do so (If you see this button this is the case). 
    After a request is made, the video will be downloaded as soon as the vessel is back in the harbour. This usually takes
    up to 2 days. After the download is completed, you will be sent the video by a member of the BMO team.
    <br><br>
    If a video of interest is not available, this usually means the video has been deleted (we have limited storage space).
    This will not happen until at least a month has passed. We cannot recover deleted videos. To get access to a video which
    was already requested before, send an email to <a href = "mailto: info@bmo-offshore.com">info@bmo-offshore.com</a>
</ng-template>