<h2 class="text-muted">Vessel report <small> {{ getMatlabDateToJSDate(vesselObject.date) }}</small></h2>
<!-- Date picker vessel reports-->
<div class="form-inline" (keyup.enter)="searchTransfersByNewSpecificDate()">
    <div class="form-group">
        <div class="input-group datepicker-input">
            <input class="form-control form-control-lg" ngbDatepicker #dp="ngbDatepicker" name="dp" [minDate]="{year: 2014, month: 1, day: 1}"
                [outsideDays]="outsideDays" [displayMonths]='1' [maxDate]="maxDate" [(ngModel)]="datePickerValue"
                (ngModelChange)="onChange()" [dayTemplate]="customDay">
            <ng-template #customDay let-date="date" let-currentMonth="currentMonth" let-selected="selected"
                let-disabled="disabled" let-focused="focused">
                <div class="custom-day btn-light" [class.bg-primary]="selected" [class.disable-day]="disabled"
                    [class.text-muted]="disabled" [class.has-sailed]="hasSailed(date)">
                    {{ date.day }}
                </div>
            </ng-template>
            <button class="input-group-addon" (click)="dp.toggle()" type="button">
                <span class="fa fa-calendar"></span>
            </button>
        </div>
    </div>
    <div class="form-group">
        <select class="form-control form-control-lg boatSelectDropdown" name="selectVessel" [(ngModel)]="vesselObject.mmsi" (change)="onChange($event)" required [disabled]="tokenInfo.userPermission == 'Vessel master'">
            <option class="dropdown-item" *ngFor="let vessel of vessels" [ngValue]="vessel.mmsi">{{vessel.nicename}}</option>
        </select>
    </div>
</div>
<!-- Plotting map-->
<br>
<div class="loader" *ngIf="!loaded || !turbinesLoaded">
    <div class="spinner">
        <div class="bounce1"></div>
        <div class="bounce2"></div>
        <div class="bounce3"></div>
    </div>
</div>
<div id="routeMap" style="width: 100%">
<div [hidden]="!loaded || !turbinesLoaded">
    <div *ngIf="noPermissionForData == false; else noPermission">
        <div class="divContainer" *ngIf="showContent == true; else other_content">
            <div *ngIf="showMap; else no_map_available">
                <div *ngIf="!routeFound" class="alert alert-warning" role="alert">
                    <b>Warning!</b> no route found for the selected day and vessel.
                </div>
                <div *ngIf="vesselObject.vesselType == 'CTV' && !parkFound" class="alert alert-warning" role="alert">
                    <b>Warning!</b> no parks found for the selected day and vessel.
                </div>
                <div *ngIf="vesselObject.vesselType == 'CTV' && parkFound && !transferVisitedAtLeastOneTurbine" class="alert alert-primary" role="alert">
                    <b>Info,</b> parks were found but have not been visited by ship.
                </div>
                <agm-map #gm [scrollwheel]='null' [scaleControl] ="true" [latitude]="latitude" [longitude]="longitude" [zoom]="mapZoomLvl" [mapTypeId]="mapTypeId" [streetViewControl]="streetViewControl" [gestureHandling]="'cooperative'">
                    <ng-container *ngFor="let turbineParkPerLocation of vesselTurbines.turbineLocations; let i=index">
                        <!--Drawing turbines-->
                        <ng-container *ngIf="turbineParkPerLocation[0].shipHasSailedBy">
                            <agm-marker [zIndex]="2" [iconUrl]="visitedIconMarker" [latitude]="objectToInt(turbineParkPerLocation[0].latitude)" [longitude]="objectToInt(turbineParkPerLocation[0].longitude)"
                                        (mouseOver)="onMouseOver(infoWindow, gm)">
                                <agm-info-window #infoWindow>  [disableAutoPan]="true"
                                    <strong style="font-size: 15px;">{{ turbineParkPerLocation[0].location }} Turbine transfers</strong>
                                    <ng-container *ngFor="let turbinePark of turbineParkPerLocation">
                                        <ng-container *ngIf="turbinePark.transfer" >
                                            <pre>
Start: {{getMatlabDateToCustomJSTime(turbinePark.transfer.startTime, 'HH:mm')}}
Stop: {{getMatlabDateToCustomJSTime(turbinePark.transfer.stopTime, 'HH:mm')}}
Duration: {{GetDecimalValueForNumber(turbinePark.transfer.duration, ' minutes')}}
                                            </pre>
                                        </ng-container>
                                    </ng-container>
                                </agm-info-window>
                            </agm-marker>
                        </ng-container>
                        <!-- Need 2 cases of markers in order to display info only on visited turbines -->
                        <ng-container *ngIf="!turbineParkPerLocation[0].shipHasSailedBy">
                            <agm-marker [latitude]="objectToInt(turbineParkPerLocation[0].latitude)" [longitude]="objectToInt(turbineParkPerLocation[0].longitude)" [iconUrl]="iconMarker" [markerClickable]="false"></agm-marker>
                        </ng-container>
                    </ng-container>
                    <ng-container *ngFor="let platformList of platformLocations.turbineLocations; let i=index">
                        <!--Drawing platforms-->
                        <ng-container *ngIf="platformList[0].shipHasSailedBy">
                            <agm-marker [zIndex]="2" [iconUrl]="visitedPlatformMarker" [latitude]="objectToInt(platformList[0].latitude)" [longitude]="objectToInt(platformList[0].longitude)" 
                            (mouseOver)="onMouseOver(infoWindow, gm)">
                                <agm-info-window #infoWindow  [disableAutoPan]="true">
                                    <strong style="font-size: 15px;">{{ platformList[0].location }} Platform transfers</strong>
                                    <ng-container *ngFor="let turbinePark of platformList">
                                        <ng-container *ngIf="turbinePark.transfer">
                                            <pre>
Start: {{getMatlabDateToCustomJSTime(turbinePark.transfer.startTime, 'HH:mm')}}
Stop: {{getMatlabDateToCustomJSTime(turbinePark.transfer.stopTime, 'HH:mm')}}
Duration: {{GetDecimalValueForNumber(turbinePark.transfer.duration, ' minutes')}}
                                            </pre>
                                        </ng-container>
                                    </ng-container>
                                </agm-info-window>
                            </agm-marker>
                        </ng-container>
                    </ng-container>
                    <!-- Drawing the actual route-->
                    <agm-polyline [strokeColor]="'#FF0000'" [strokeWeight]="1.5">
                        <ng-container *ngFor="let location of boatLocationData; let i = index">
                            <agm-polyline-point *ngFor="let loc of location.lat; let i = index" 
                                                [latitude]="objectToInt(loc)"
                                                [longitude]="objectToInt(location.lon[i])">
                            </agm-polyline-point>
                        </ng-container>
                    </agm-polyline>
                </agm-map>
            </div>
        </div>
        <!-- No idea -->
        <app-ctvreport *ngIf="vesselObject.vesselType == 'CTV'" (loaded)="isLoaded($event)" [vesselObject]="vesselObject"
            [mapPixelWidth]="mapPixelWidth" [tokenInfo]="tokenInfo" (showContent)="getShowContent($event)" (sailDates)="getDatesHasSailed($event)"
            (mapZoomLvl)="getMapZoomLvl($event)" (boatLocationData)="getBoatLocationData($event)" (turbineLocationData)="getTurbineLocationData($event)"
            (latitude)="getLatitude($event)" (longitude)="getLongitude($event)" (routeFound)="getRouteFound($event)" (parkFound)="getParkFound($event)"
            (platformLocationData)="getPlatformLocationData($event)">
        </app-ctvreport>
        <app-sovreport *ngIf="vesselObject.vesselType == 'SOV' || vesselObject.vesselType == 'OSV'" (loaded)="isLoaded($event)"
            [vesselObject]="vesselObject" [mapPixelWidth]="mapPixelWidth" (showContent)="getShowContent($event)" (sailDates)="getDatesHasSailed($event)"
            (mapZoomLvl)="getMapZoomLvl($event)" (boatLocationData)="getBoatLocationData($event)" (turbineLocationData)="getTurbineLocationData($event)"
            (latitude)="getLatitude($event)" (longitude)="getLongitude($event)" (routeFound)="getRouteFound($event)"
            (platformLocationData)="getPlatformLocationData($event)">
        </app-sovreport>
    </div>
    <ng-template #other_content>
        <div class="divContainer">
            <h3>There is no data available for the selected day and vessel.</h3>
        </div>
    </ng-template>
    <ng-template #noPermission>
        <div class="divContainer">
            <h3>You are not allowed to view the vessel you requested</h3>
        </div>
    </ng-template>
    <ng-template #no_map_available>
        <div class="divContainer">
            <h3>There is no map available for the selected day and vessel.</h3>
        </div>
    </ng-template>
</div>
</div>
