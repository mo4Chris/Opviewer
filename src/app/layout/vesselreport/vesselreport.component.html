
<div *ngIf="showContent">
    <h2 class="text-muted">Vessel report <small> {{ MatlabDateToJSDate(vesselObject.date) }} </small></h2>
    <div class="col-lg-12">
        <form class="form-inline mb-3">
            <div class="form-group" (keyup.enter)="searchTransfersByNewSpecificDate()">
                <div class="input-group datepicker-input">
                    <input class="form-control" ngbDatepicker #dp="ngbDatepicker" name="dp" [minDate]="{year: 2014, month: 1, day: 1}" [outsideDays]="outsideDays" [displayMonths]='1' [maxDate]="maxDate" [(ngModel)]="datePickerValue" (ngModelChange)="onChange($event)" [dayTemplate]="customDay" >

                    <ng-template #customDay let-date="date" let-currentMonth="currentMonth" let-selected="selected" let-disabled="disabled" let-focused="focused">
                            <div class="custom-day btn-light" [class.bg-primary]="selected" [class.disable-day]="disabled" [class.text-muted]="disabled" [class.has-sailed]="hasSailed(date)">
                                {{ date.day }}
                            </div>
                        </ng-template>

                    <button class="input-group-addon" (click)="dp.toggle()" type="button">
                        <span class="fa fa-calendar"></span>
                    </button>
                    <div class="form-group">
                        <select class="form-control boatSelectDropdown" name="selectVessel" [(ngModel)]="vesselObject.mmsi" (change)="onChange($event)" required [disabled]="tokenInfo.userPermission == 'Vessel master'">
                            <option class="dropdown-item" *ngFor="let vessel of vessels" [ngValue]="vessel.mmsi">{{vessel.nicename}}</option>
                        </select>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <div *ngIf="noPermissionForData == false; else noPermission">
        <div class="divContainer" *ngIf="transferData?.length > 0; else other_content">
            <div class="leftdiv">
                <agm-map [latitude]="latitude" [longitude]="longitude"  [zoom]="zoomlvl" [mapTypeId]="mapTypeId" [gestureHandling]="cooperative" [streetViewControl]="streetViewControl">
                    <ng-container *ngFor="let parks of Locdata; let i=index" >
                        <agm-circle [radius]="200" [fillOpacity]="0.8" *ngFor="let geo of parks.lat; let i = index" [latitude]="objectToInt(geo)" [longitude]="objectToInt(parks.lon[i])" >
                        </agm-circle>
                    </ng-container>
                    <agm-polyline [strokeColor]="'#FF0000'" [strokeWeight]="1.5">
                            <ng-container *ngFor="let location of boatLocationData; let i = index" >
                                <agm-polyline-point *ngFor="let loc of location.lat; let i = index"  [latitude]="objectToInt(loc)" [longitude]="objectToInt(location.lon[i])" >
                                </agm-polyline-point>
                            </ng-container>
                    </agm-polyline>
                </agm-map>
            </div>
            <div class="rightdiv">  
                <agm-map [latitude]="latitude" [longitude]="longitude" [zoom]="11" [mapTypeId]="mapTypeId" [gestureHandling]="cooperative" [disableDefaultUI]="true" [streetViewControl]="streetViewControl">
                    <ng-container *ngFor="let parks of Locdata; let i=index" >
                        <agm-circle [fillOpacity]="0.8" [radius]="100" *ngFor="let geo of parks.lat; let i = index" [latitude]="objectToInt(geo)" [longitude]="objectToInt(parks.lon[i])" >
                        </agm-circle>
                    </ng-container>
                    <agm-polyline [strokeColor]="'#F00'" [strokeWeight]="1.5">
                            <ng-container *ngFor="let location of boatLocationData; let i = index" >
                                <agm-polyline-point *ngFor="let loc of location.lat; let i = index"  [latitude]="objectToInt(loc)" [longitude]="objectToInt(location.lon[i])" >
                                </agm-polyline-point>
                            </ng-container>
                    </agm-polyline>
                </agm-map>
            </div>
        </div>
    </div>
    <ng-template #other_content>
        <div class="divContainer">
            <h3>There is not data available for the selected day and vessel.</h3>
        </div>
    </ng-template>
    <br><br>
    <div class="divContainer" *ngIf="transferData?.length > 0 && !noTransits">
        <table class="table table-responsive">
            <tr>
                <td class="keyTD">Departure Port</td>
                <td>{{MatlabDateToJSTime(general.portDepartureTime)}}</td>
                <td class="keyTD">Departure Wind Farm</td>
                <td>{{MatlabDateToJSTime(general.departureWindFarmTime)}}</td>
            </tr>
            <tr>
                <td class="keyTD">Arrival wind farm</td>
                <td>{{MatlabDateToJSTime(general.WindFarmArrivalTime)}}</td>
                <td class="keyTD">Arrival Port</td>
                <td>{{MatlabDateToJSTime(general.portArrivalTime)}}</td>
            </tr>
            <tr>
                <td class="keyTD">Distance Sailed</td>
                <td>{{general.sailedDistance | number:'1.1-1'}} NM</td>
                <td class="keyTD">Fuel Consumed</td>
                <td>{{general.TotalFuel}}</td>
            </tr>
            <tr>
                <td></td>
                <td></td>
                <td class="keyTD">Fuel Economy</td>
                <td>{{general.FuelEcon}}</td>
            </tr>
            <tr>
                <td class="keyTD">Avg. speed outbound</td>
                <td>{{general.AvgSpeedOutbound | number:'1.1-1'}} knots</td>
                <td class="keyTD">Avg. speed inbound</td>
                <td>{{general.AvgSpeedInbound | number:'1.1-1'}} knots</td>
            </tr>
            <tr>
                <td class="keyTD">Max. speed outbound</td>
                <td>{{general.AvgSpeedOutboundUnrestricted | number:'1.1-1'}} knots</td>
                <td class="keyTD">Max. speed inbound</td>
                <td>{{general.AvgSpeedInboundUnrestricted | number:'1.1-1'}} knots</td>
            </tr>
            <tr>
                <td class="keyTD">MSI outbound</td>
                <td>{{general.MsiOutbound | number:'1.1-1'}}%</td>
                <td class="keyTD">MSI inbound</td>
                <td>{{general.MsiInbound | number:'1.1-1'}}%</td>
            </tr>
            <tr>
                <td class="keyTD">WBV, Technicians</td>
                <td>{{general.WBVtechs | number:'1.1-2'}} (A8)</td>
                <td class="keyTD">WBV, Vessel Crew</td>
                <td>{{general.WBVcrew | number:'1.1-2'}} (A8)</td>
            </tr>
            <tr>
                <td class="keyTD">Number of dockings</td>
                <td>{{general.numDockings}}</td>
                <td class="keyTD">Average Docking Time</td>
                <td>{{general.AverageDockedTime}}</td>
            </tr>
        </table>
    </div>
    <br><br>
    <div class="divContainer" *ngIf="transferData?.length > 0">
        <h3>Dockings</h3>
        <table class="table table-hover table-striped">
            <thead>
                <tr>
                    <th>#</th>
                    <th>start time</th>
                    <th>stop time</th>
                    <th>duration</th>
                    <th>score</th>
                    <th>location</th>
                    <th>comment</th>
                    <th>detector</th>
                    <th>save</th>
                    <th *ngIf="videoRequestPermission">video request</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let transfer_Data of transferData;let ind = index" ng-form="myForm">
                    <td>{{ind + 1}}</td>  
                    <td>{{MatlabDateToJSTime(transfer_Data.startTime)}}</td>
                    <td>{{MatlabDateToJSTime(transfer_Data.stopTime)}}</td>  
                    <td>{{MatlabDateToJSTimeDifference(transfer_Data.stopTime, transfer_Data.startTime)}}</td>
                    <td>{{transfer_Data.score}}</td> 
                    <td>{{transfer_Data.location}}</td>  
                    <td class="comment">
                        <span ngbDropdown class="d-inline-block dropdown">
                            <button class="btn btn-outline-primary" [class.commentOptions]="transfer_Data.comment != 'Other'" ngbDropdownToggle>
                                <span [class.commentButton]="transfer_Data.comment != 'Other'">{{transfer_Data.comment}}</span>
                            </button>
                            <span ngbDropdownMenu>
                                <button *ngFor="let opt of commentOptions" class="dropdown-item" (click)="transfer_Data.comment = opt;transfer_Data.formChanged=true">{{opt}}</button>
                            </span>
                        </span>
                        <span *ngIf="transfer_Data.comment == 'Other'">
                            <input name="otherComment" [(ngModel)]="transfer_Data.commentChanged.otherComment" type="text" class="form-control otherComment" (ngModelChange)="transfer_Data.formChanged=true"  />
                        </span>
                    </td>
                    <td>{{transfer_Data.detector}}</td>
                    <td>
                        <button class="btn btn-lg btn-primary submitBtnDate" (click)="saveComment(transfer_Data)" type="button" [disabled]="!transfer_Data.formChanged">Save</button>
                    </td>
                    <td *ngIf="videoRequestPermission">
                        <button *ngIf="transfer_Data.video_requested" class="btn btn-lg btn-primary submitBtnDate videoRequest {{transfer_Data.video_requested.status}}" (click)="setRequest(transfer_Data);" type="button" [disabled]="transfer_Data.videoAvailable == 0 || transfer_Data.video_requested.disabled">{{transfer_Data.video_requested.text}}</button>
                    </td>
                </tr>
            </tbody>
        </table>
        <ngb-alert *ngIf="showAlert" [type]="alert.type" (close)="showAlert=false">{{ alert.message }}</ngb-alert>
    </div>
    <ng-template #noPermission>
        <div class="divContainer">
            <h3>You are not allowed to view the boat you requested</h3>
        </div>
    </ng-template>
    <div class="videoRequestLoading" *ngIf="videoRequestLoading">
        <div class="spinner">
            <div class="bounce1"></div>
            <div class="bounce2"></div>
            <div class="bounce3"></div>
        </div>
    </div>
</div>
