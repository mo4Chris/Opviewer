:host {
  // Colors
  --sidebar-background-color: var(--primary-container, rgba(24, 7, 58, 0.9));
  --sidebar-color: var(--on-primary-container, #fff);
  --sidebar-icon-color: var(--on-primary-container, #fff);
  --sidebar-icon-active-color: var(--on-secondary-container, #007bff);

  // Typography
  --sidebar-font-family: var(--font-body);

  // State (surface)
  --sidebar-icon-surface-opacity: 0;
  --sidebar-icon-surface-color: var(--secondary-container);
  --sidebar-icon-surface-hover-opacity: 0.4;
  --sidebar-icon-surface-focus-opacity: 0.6;
  --sidebar-icon-surface-active-opacity: 0.8;
  --sidebar-icon-surface-active-link-opacity: 0.9;

  // Overlay
  --sidebar-overlay-color: var(--primary-container, rgba(24, 7, 58, 0.9));
  --sidebar-overlay-opacity: 0.4;

  // Scaling
  --sidebar-size-adjust: 0rem;
}

.portal-sidebar {
  position: fixed;
  z-index: 2000;
  left: 0;
  top: 0;
  bottom: 0;
  height: 100%;
  color: var(--sidebar-color);
  background-color: var(--sidebar-background-color);
  font-family: var(--sidebar-font-family);

  display: flex;
}

// Exception for classic theme
.theme-classic :host {
  --sidebar-icon-surface-color: var(--secondary);
  --sidebar-icon-active-color: var(--secondary-container);
}

// Exception for light theme (insufficient contrast)
.theme-light :host {
  --sidebar-icon-surface-color: var(--secondary);
  --sidebar-icon-active-color: var(--secondary-container);
}

:host {
  --sidebar-size-adjust: CLAMP(-0.75rem, -0.75rem + 0.6349vh, 0rem);
  --sidebar-space-top: calc(var(--size-4) + var(--sidebar-size-adjust));
  --sidebar-space-bottom: calc(var(--size-4) + var(--sidebar-size-adjust));
}

@media screen and (min-height: 630px) {
  :host {
    --sidebar-size-adjust: CLAMP(-0.5rem, -2.3529rem + 4.7059vh, 0rem);
  }
}

.portal-sidebar--hide .portal-sidebar__icons .portal-sidebar__label {
  width: 0px;
  margin-left: 0px;
  opacity: 0;
}

.portal-sidebar--measure .portal-sidebar__icons .portal-sidebar__label {
  transition: none !important;
}

.portal-sidebar__groups {
  display: flex;
  flex-direction: column;
  gap: var(--size-12);
  height: 100%;
  padding-top: var(--size-4);
  padding-bottom: var(--size-4);
}

.portal-sidebar__spacer {
  display: none;
}

@media screen and (min-height: 800px) {
  .portal-sidebar__spacer {
    display: block;
    flex: 1 0;
  }
}

.portal-sidebar__logo {
  position: relative;
  width: var(--size-8);
  height: var(--size-9);
  margin-bottom: var(--size-4);

  app-portal-logo {
    position: absolute;
    left: 0;
    top: 0;
    width: var(--size-36);
    height: 100%;
  }
}

.portal-sidebar__icons {
  display: flex;
  flex-direction: column;
  font-size: var(--size-5);

  .portal-sidebar__icon {
    color: var(--sidebar-icon-color);
    min-height: var(--size-4);
    padding-left: var(--size-4);
    padding-right: var(--size-4);
    padding-top: var(--sidebar-space-top);
    padding-bottom: var(--sidebar-space-bottom);

    display: flex;
    align-items: baseline;
  }

  .portal-sidebar__icon {
    position: relative;

    &::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: var(--sidebar-icon-surface-opacity);
      background: var(--sidebar-icon-surface-color);
      z-index: -1;
      transition: opacity 0.15s var(--transition-out);
    }

    &:hover {
      text-decoration: none;
      --sidebar-icon-surface-opacity: var(--sidebar-icon-surface-hover-opacity);
    }

    &:focus {
      --sidebar-icon-surface-opacity: var(--sidebar-icon-surface-focus-opacity);
      // It's safe to remove the default outline since we're providing a custom style here.
      outline: none;
    }

    &:active {
      --sidebar-icon-surface-opacity: var(
        --sidebar-icon-surface-active-opacity
      );
    }

    &.router-link-active {
      --sidebar-icon-surface-opacity: var(
        --sidebar-icon-surface-active-link-opacity
      );
      color: var(--sidebar-icon-active-color);
    }

    // Exceptions for specific icons
    & .fa-history {
      transform: scaleX(-1) scale(1.2);
    }

    & .fa-home {
      transform: scale(1.2);
    }
  }

  .portal-sidebar__label {
    will-change: opacity;
    width: var(--sidebar-expanded-width, 100%);
    font-size: var(--size-4);
    margin-left: var(--size-4);
    opacity: 1;
    overflow: hidden;
    white-space: nowrap;
    transition: width 0.2s var(--transition-out),
      margin-left 0.3s var(--transition-out), opacity 0.2s var(--transition-out);
  }

  button {
    background: none;
    border: none;
    text-align: left;
  }
}

.portal-sidebar__overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 1999;
  opacity: var(--sidebar-overlay-opacity);
  background: var(--sidebar-background-color);
  transition: opacity 0.4s var(--transition-out);
}

.portal-sidebar__overlay--hide {
  pointer-events: none;
  opacity: 0;
}

@media print {
  .portal-sidebar {
    display: none;
  }
}
